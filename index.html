<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>街と分解者プランター：整理版</title>
<style>
body {
  margin:0; font-family:sans-serif; background:#0b1d3a; color:#eef; text-align:center;
}
h1 { margin:16px 0; }
#grid {
  display:grid;
  grid-template-columns: repeat(10, 50px);
  grid-template-rows: repeat(10, 50px);
  gap:2px;
  margin:20px auto;
  width:520px;
}
.tile {
  width:50px; height:50px;
  background:#3aaed8; border-radius:6px; cursor:pointer;
  transition:0.3s;
}
.tile.green{background:#28a745;}    /* 公園 */
.tile.road{background:#6c757d;}     /* 道路 */
.tile.factory{background:#ff6b6b;}  /* 工場 */
.tile.empty{background:#3aaed8;}    /* 空き */

.soil {
  margin:20px auto; width:520px; height:120px;
  background:#3b2a1a; border-radius:12px; position:relative; overflow:hidden;
}
.line {
  position:absolute; width:2px; height:60px;
  background:rgba(0,255,180,0.8); animation:pulse 2s infinite;
}
.dead { background: rgba(120,120,120,0.3); animation:none; }
.garbage {
  position:absolute; width:12px; height:12px; border-radius:50%;
  background:#888; transition: top 0.8s linear;
}
@keyframes pulse { 0%{opacity:0.2}50%{opacity:1}100%{opacity:0.2} }
</style>
</head>
<body>

<h1>街と分解者プランター：整理版</h1>

<div id="grid"></div>

<div class="soil" id="soil">
  <p id="soilStatus">分解者ネットワーク: 活発</p>
</div>

<p>クリックでタイル切り替え、街を作ろう</p>
<p>タイル: 緑=公園, 灰=道路, 赤=工場, 青=空き</p>

<script>
const gridSize=10;
const grid=document.getElementById("grid");
const soil=document.getElementById("soil");
const soilStatus=document.getElementById("soilStatus");
let health=100;
const typeOrder=["green","road","factory","empty"];

// 初期化
for(let i=0;i<gridSize*gridSize;i++){
  const tile=document.createElement("div");
  tile.className="tile empty"; tile.dataset.type="empty";
  tile.addEventListener("click",()=>{placeTile(tile)});
  grid.appendChild(tile);
}

// タイル操作
function placeTile(tile){
  let nextType=typeOrder[(typeOrder.indexOf(tile.dataset.type)+1)%typeOrder.length];
  tile.dataset.type=nextType;
  tile.className="tile "+nextType;

  // 健康変化
  if(nextType==="green") health+=5;
  if(nextType==="road") health-=2;
  if(nextType==="factory") health-=5;
  health=Math.min(100,Math.max(0,health));

  // 工場はゴミ生成
  if(nextType==="factory") createGarbage(tile);

  updateSoil();
}

// 土壌更新
function updateSoil(){
  soilStatus.textContent="分解者ネットワーク: "+(health>70?"活発":health>40?"不安定":"断裂中");
  document.querySelectorAll(".line").forEach(l=>l.remove());
  const lines=Math.max(1,Math.floor(health/15));
  for(let i=0;i<lines;i++){
    const l=document.createElement("div");
    l.className="line"+(health<40?" dead":"");
    l.style.left=Math.random()*100+"%";
    l.style.top=Math.random()*40+"px";
    soil.appendChild(l);
  }
}

// ゴミ生成・落下
function createGarbage(tile){
  const garbage=document.createElement("div");
  garbage.className="garbage";
  // grid 内座標を soil 内のランダム位置に変換
  garbage.style.left = (Math.random()*500)+"px";
  garbage.style.top = "0px";
  soil.appendChild(garbage);

  // 落下
  setTimeout(()=>{
    garbage.style.top = "100px";
  },50);

  // 分解後削除
  setTimeout(()=>{
    garbage.remove();
    health=Math.min(100,health+3);
    updateSoil();
  },1200);
}

updateSoil();
</script>

</body>
</html>
