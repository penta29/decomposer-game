<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>街と分解者プランター：ゴミ落下版</title>
<style>
  body { margin:0; font-family: sans-serif; background:#0b1d3a; color:#eef; text-align:center;}
  h1 { margin:16px 0; }
  #grid { 
    display:grid; 
    grid-template-columns: repeat(10, 50px); 
    grid-template-rows: repeat(10, 50px); 
    gap:2px; 
    margin:20px auto;
  }
  .tile { width:50px; height:50px; background:#3aaed8; border-radius:6px; cursor:pointer; transition:0.3s;}
  .tile.green{background:#28a745;}
  .tile.road{background:#6c757d;}
  .tile.factory{background:#ff6b6b;}
  .soil { margin:20px auto; width:520px; height:120px; background:#3b2a1a; border-radius:12px; position:relative; overflow:hidden;}
  .line { position:absolute; width:2px; height:60px; background:rgba(0,255,180,0.8); animation:pulse 2s infinite; }
  .dead { background: rgba(120,120,120,0.3); animation:none; }
  .garbage { position:absolute; width:12px; height:12px; background:#888; border-radius:50%; transition: top 1s linear; }
  @keyframes pulse { 0%{opacity:0.2}50%{opacity:1}100%{opacity:0.2} }
</style>
</head>
<body>

<h1>街と分解者プランター：ゴミ落下版</h1>

<div id="grid"></div>

<div class="soil" id="soil">
  <p id="soilStatus">分解者ネットワーク: 活発</p>
</div>

<p>クリックでタイルを切り替え、街を作ろう</p>
<p>タイル: 緑=公園, 灰=道路, 赤=工場, 青=未配置</p>

<script>
const gridSize = 10;
const grid = document.getElementById("grid");
const soilStatus = document.getElementById("soilStatus");
const soilDiv = document.getElementById("soil");
let health = 100;

// 初期化
for(let i=0;i<gridSize*gridSize;i++){
  const tile = document.createElement("div");
  tile.className="tile";
  tile.dataset.type="empty";
  tile.addEventListener("click",()=>{placeTile(tile)});
  grid.appendChild(tile);
}

// タイル操作
function placeTile(tile){
  let typeOrder = ["green","road","factory","empty"];
  let nextType = typeOrder[(typeOrder.indexOf(tile.dataset.type)+1)%typeOrder.length];
  tile.dataset.type = nextType;
  tile.className="tile "+(nextType!=="empty"?nextType:"");

  // 健康変化
  if(nextType==="green") health+=5;
  if(nextType==="road") health-=2;
  if(nextType==="factory") health-=5;
  if(nextType==="empty") health+=0;
  health = Math.min(100, Math.max(0, health));

  // 工場はゴミを落とす
  if(nextType==="factory") createGarbage(tile);

  updateSoil();
}

// 土壌更新
function updateSoil(){
  soilStatus.textContent = "分解者ネットワーク: " + (health>70?"活発":health>40?"不安定":"断裂中");
  // 線描画
  document.querySelectorAll(".line").forEach(l=>l.remove());
  const lines = Math.max(1, Math.floor(health/15));
  for(let i=0;i<lines;i++){
    const l = document.createElement("div");
    l.className="line"+(health<40?" dead":"");
    l.style.left = Math.random()*100+"%";
    l.style.top = Math.random()*40+"px";
    soilDiv.appendChild(l);
  }
}

// ゴミ生成・落下
function createGarbage(tile){
  const rect = tile.getBoundingClientRect();
  const soilRect = soilDiv.getBoundingClientRect();
  const garbage = document.createElement("div");
  garbage.className="garbage";
  garbage.style.left = (tile.offsetLeft + 20) + "px";
  garbage.style.top = (tile.offsetTop + 10) + "px";
  document.body.appendChild(garbage);

  // 下の土壌に落下
  setTimeout(()=>{
    garbage.style.top = (soilRect.top + Math.random()*80) + "px";
  }, 50);

  // 分解アニメ
  setTimeout(()=>{
    garbage.remove();
    health = Math.min(100, health + 3); // ゴミ分解で健康回復
    updateSoil();
  }, 1200);
}

updateSoil();
</script>

</body>
</html>
