<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<title>ãƒ—ãƒ©ãƒãƒƒãƒˆãƒ—ãƒ©ãƒ³ã‚¿ãƒ¼é¢¨ éƒ½å¸‚ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</title>
<style>
body{margin:0;display:flex;font-family:sans-serif;background:#f4f6f8}
#game{flex:3;padding:10px}
#ui{flex:1;background:#ffffff;border-left:2px solid #ccc;padding:10px;overflow-y:auto}
.grid{display:grid;grid-template-columns:repeat(8,1fr);gap:4px}
.cell{aspect-ratio:1;background:#ddd;border-radius:6px;display:flex;align-items:center;justify-content:center;font-size:12px;cursor:pointer;position:relative}
.cell span{font-size:10px;position:absolute;bottom:2px;right:4px}
button{margin:2px}
.seed-btn{padding:6px 10px;border-radius:6px;border:none;cursor:pointer}
</style>
</head>
<body>
<div id="game">
<h2>éƒ½å¸‚ã‚¨ãƒªã‚¢</h2>
<div class="grid" id="grid"></div>
<h3>ã‚¿ãƒé¸æŠ</h3>
<div id="seeds"></div>
</div>
<div id="ui">
<h2>ğŸ“˜ ãƒ«ãƒ¼ãƒ«ãƒ–ãƒƒã‚¯</h2>
<div id="rulebook"></div>
</div>
<script>
const SIZE=8;
const gridEl=document.getElementById('grid');
const seedsEl=document.getElementById('seeds');
let selectedSeed='ä½å®…';

const SEEDS={
ä½å®…:{color:'#e74c3c'},
ç·‘åœ°:{color:'#2ecc71'},
å·¥å ´:{color:'#f1c40f'},
å•†æ¥­:{color:'#3498db'},
å…¬åœ’:{color:'#1abc9c',advanced:true},
è¤‡åˆå•†æ¥­:{color:'#9b59b6',advanced:true},
ç’°å¢ƒå·¥å ´:{color:'#27ae60',advanced:true}
};

let grid=[];

function init(){
 for(let i=0;i<SIZE*SIZE;i++){
  grid.push({type:null,level:0});
 }
 renderGrid();renderSeeds();updateRulebook();
}

function renderGrid(){
 gridEl.innerHTML='';
 grid.forEach((c,i)=>{
  const d=document.createElement('div');
  d.className='cell';
  if(c.type){d.style.background=SEEDS[c.type].color;d.innerHTML=c.type+'<span>Lv'+c.level+'</span>'}
  d.onclick=()=>placeSeed(i);
  gridEl.appendChild(d);
 });
}

function renderSeeds(){
 seedsEl.innerHTML='';
 Object.keys(SEEDS).forEach(k=>{
  if(SEEDS[k].advanced) return;
  const b=document.createElement('button');
  b.className='seed-btn';
  b.style.background=SEEDS[k].color;
  b.textContent=k;
  b.onclick=()=>selectedSeed=k;
  seedsEl.appendChild(b);
 });
}

function placeSeed(i){
 const c=grid[i];
 if(!c.type){c.type=selectedSeed;c.level=1;}
 else if(c.type===selectedSeed){c.level++;checkLevelUp(i)}
 checkCombo(i);
 checkDisaster();
 renderGrid();
}

function checkLevelUp(i){
 const c=grid[i];
 if(c.type==='ç·‘åœ°' && c.level>=3){c.type='å…¬åœ’';c.level=1;flash();}
 if(c.type==='å•†æ¥­' && c.level>=3){c.type='è¤‡åˆå•†æ¥­';c.level=1;flash();}
}

function checkCombo(i){
 const c=grid[i];
 if(c.type==='å·¥å ´' && c.level>=2){
  const greens=grid.filter(x=>x.type==='ç·‘åœ°').length;
  if(greens>=3){c.type='ç’°å¢ƒå·¥å ´';c.level=1;flash();}
 }
}

function checkDisaster(){
 const houses=grid.filter(c=>c.type==='ä½å®…').length;
 const greens=grid.filter(c=>c.type==='ç·‘åœ°'||c.type==='å…¬åœ’').length;
 if(houses>=10 && greens<3 && Math.random()<0.1){alert('ğŸ¦  ç–«ç—…ç™ºç”Ÿï¼');}
 if(greens<2 && Math.random()<0.1){alert('ğŸŒ¾ å‡¶ä½œç™ºç”Ÿï¼');}
 if(Math.random()<0.05){alert('ğŸŒ‹ è‡ªç„¶ç½å®³ï¼');}
}

function flash(){document.body.style.background='#fff';setTimeout(()=>document.body.style.background='#f4f6f8',80)}

function updateRulebook(){
 document.getElementById('rulebook').innerHTML=`
<b>â–  åŸºæœ¬ã‚¿ãƒ</b><br>
ğŸ”´ä½å®… ğŸ”µå•†æ¥­ ğŸŸ¢ç·‘åœ° ğŸŸ¡å·¥å ´<br><br>
<b>â–  ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—</b><br>
ç·‘åœ°Lv3 â†’ å…¬åœ’<br>
å•†æ¥­Lv3 â†’ è¤‡åˆå•†æ¥­<br><br>
<b>â–  åˆã‚ã›æŠ€</b><br>
å·¥å ´Lv2 + ç·‘åœ°3 â†’ ç’°å¢ƒå·¥å ´<br><br>
<b>â–  ç½å®³</b><br>
è‡ªç„¶ç½å®³ï¼šæ¯ã‚¿ãƒ¼ãƒ³5%<br>
å‡¶ä½œï¼šç·‘åœ°2æœªæº€<br>
ç–«ç—…ï¼šä½å®…10ä»¥ä¸Š+ç·‘åœ°ä¸è¶³<br>`;
}

init();
</script>
</body>
</html>
